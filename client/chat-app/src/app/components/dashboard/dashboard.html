<div class="chat-container">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <strong>Chat System</strong>
      <span class="role-badge" [ngClass]="{
        'super-admin': isSuperAdmin(),
        'group-admin': isGroupAdmin(),
        'user': !isSuperAdmin() && !isGroupAdmin()
      }">{{ getRoleText() }}</span>
    </div>
    <div class="header-right">
      Welcome, {{ currentUser?.username }} | 
      <button class="btn btn-sm btn-outline-light" (click)="logout()">Logout</button>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="section-title">My Groups</div>
      <div class="list-item" *ngFor="let group of groups" (click)="selectGroup(group)">
        {{ group.name }}
        <span *ngIf="group.isOwner" class="text-muted">(Owner)</span>
      </div>
      
      <div class="section-title">Channels</div>
      <div class="list-item" *ngFor="let channel of channels" (click)="selectChannel(channel)">
        # {{ channel.name }}
      </div>
      
      <!-- Role-specific sidebar buttons -->
      <div class="sidebar-actions" *ngIf="isGroupAdmin()">
        <button class="btn btn-success btn-sm w-100 mt-2">Create New Group</button>
      </div>
      
      <div class="sidebar-actions" *ngIf="!isSuperAdmin() && !isGroupAdmin()">
        <button class="btn btn-primary btn-sm mt-2">Request Group Access</button>
        <button class="btn btn-danger btn-sm mt-1">Leave Group</button>
      </div>
    </div>

    <!-- Chat Area -->
    <div class="chat-area">
      <div class="chat-header">
        <strong>Channel: {{ selectedChannel?.name || '#general' }}</strong>
        <div class="channel-info" *ngIf="!isSuperAdmin() && !isGroupAdmin()">
          <small class="text-muted">{{ onlineMembers }} members online</small>
        </div>
      </div>
      
      <div class="messages-container">
        <div class="message" *ngFor="let message of messages">
          <div class="message-header">
            <strong>{{ message.username }}</strong>
            <small class="text-muted ms-2">{{ formatTimestamp(message.timestamp) }}</small>
          </div>
          <div class="message-content">{{ message.content }}</div>
        </div>
        <div class="message-divider" *ngIf="messages.length === 0">
          <em class="text-muted">--- No messages yet. Start the conversation! ---</em>
        </div>
      </div>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" *ngIf="isSuperAdmin()">
      <div class="section-title">Super Admin Tools</div>
      
      <div class="admin-section">
        <strong>User Management</strong>
        <div class="user-creation-form" *ngIf="showCreateUserForm">
          <div class="form-group">
            <label for="newUsername">Username</label>
            <input type="text" [(ngModel)]="newUser.username" placeholder="Enter username" class="form-control">
          </div>
          <div class="form-group">
            <label for="newEmail">Email</label>
            <input type="email" [(ngModel)]="newUser.email" placeholder="Enter email" class="form-control">
          </div>
          <div class="form-group">
            <label for="newPassword">Password</label>
            <input type="password" [(ngModel)]="newUser.password" placeholder="Enter password" class="form-control">
          </div>
          <div class="form-actions">
            <button class="btn btn-success btn-sm" (click)="createUser()">Create User</button>
            <button class="btn btn-secondary btn-sm" (click)="cancelCreateUser()">Cancel</button>
          </div>
        </div>
        <button class="btn btn-success btn-sm" (click)="showCreateUserForm = !showCreateUserForm" *ngIf="!showCreateUserForm">Create New User</button>
        <div class="user-list" *ngIf="users.length > 0">
          <div class="user-item" *ngFor="let user of users">
            <div class="user-info">
              <strong>{{ user.username }}</strong>
              <span class="role-badge">{{ user.roles?.join(', ') || 'User' }}</span>
            </div>
            <div class="user-actions">
              <button class="btn btn-danger btn-sm" (click)="removeUser(user)" *ngIf="user.username !== currentUser?.username">
                Remove User
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="admin-section">
        <strong>System Overview</strong>
        <div class="system-stats">
          <div>Total Users: {{ totalUsers }}</div>
          <div>Total Groups: {{ totalGroups }}</div>
          <div>Active Channels: {{ totalChannels }}</div>
        </div>
      </div>
      
      <div class="admin-section">
        <strong>Reports & Logs</strong>
        <button class="btn btn-primary btn-sm">View Reports</button>
        <button class="btn btn-primary btn-sm">System Logs</button>
      </div>
    </div>

    <div class="admin-panel" *ngIf="isGroupAdmin()">
      <div class="section-title">Group Admin Tools</div>
      
      <div class="admin-section">
        <strong>Group: {{ selectedGroup?.name || 'Development Team' }}</strong>
        <button class="btn btn-primary btn-sm">Add Channel</button>
        <button class="btn btn-primary btn-sm">Manage Members</button>
        <button class="btn btn-danger btn-sm">Delete Channel</button>
      </div>
      
      <div class="admin-section">
        <strong>Member Management</strong>
        <button class="btn btn-success btn-sm">Add User to Group</button>
        <button class="btn btn-danger btn-sm">Remove User</button>
        <button class="btn btn-warning btn-sm">Ban from Channel</button>
      </div>
      
      <div class="admin-section">
        <strong>Requests</strong>
        <div class="join-request" *ngFor="let request of joinRequests">
          {{ request.username }} wants to join
          <button class="btn btn-success btn-xs ms-2">Approve</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Message Input -->
  <div class="message-input">
    <input type="text" [(ngModel)]="messageText" placeholder="Type your message..." class="form-control">
    <button class="btn btn-primary" (click)="sendMessage()">Send</button>
  </div>
</div>
